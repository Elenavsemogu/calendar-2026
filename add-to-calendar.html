<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Adding to Calendar...</title>
</head>
<body>
<script>
// Получаем параметры из URL
const params = new URLSearchParams(window.location.search);
const title = params.get('title') || 'Event';
const location = params.get('location') || '';
const description = params.get('description') || '';
const start = params.get('start') || '';
const end = params.get('end') || '';

// Генерируем ICS файл
const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Secretroom//Calendar//RU
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${title.replace(/\s+/g, '-')}-${Date.now()}@secretroom
DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTSTART:${start}
DTEND:${end}
SUMMARY:${decodeURIComponent(title)}
LOCATION:${decodeURIComponent(location)}
DESCRIPTION:${decodeURIComponent(description)}
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`;

// Создаем blob и скачиваем
const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
link.href = url;
link.download = 'event.ics';
document.body.appendChild(link);
link.click();

// Показываем сообщение
document.body.innerHTML = '<div style="font-family: sans-serif; text-align: center; padding: 40px;"><h2>✅ Файл календаря загружен!</h2><p>Откройте скачанный файл для добавления события в календарь.</p><p><a href="#" onclick="window.close()">Закрыть</a></p></div>';

// Очистка
setTimeout(() => {
  URL.revokeObjectURL(url);
  document.body.removeChild(link);
}, 1000);
</script>
</body>
</html>
